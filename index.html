<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title># Notas #</title>
    <link rel="stylesheet" type="text/css" href="inc/fontawesome/css/all.min.css"/>
    <link rel="stylesheet" type="text/css" href="inc/asciidoctor.css"/>
    <link rel="stylesheet" type="text/css" href="inc/notas.css"/>
    <script src="inc/jquery-2.1.1.min.js"></script>
    <script src="inc/markdown.min.js"></script>
    <script src="inc/asciidoctor.min.js"></script>
    <link rel="icon" type="image/png" href="/favicons/favicon-128x128.png" sizes="128x128">
    <link rel="icon" type="image/png" href="/favicons/favicon-64x64.png" sizes="64x64">
    <link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
    <script>
      jQuery(function(){
        var s = (location.href.split("#")[0]||location.href);
        s = (s.split("?")[1]||'index');
        var md = false;
        var isRemote = false;
        s = s.includes('&')?s.substring(0, s.indexOf('&')):s;

        // Check if it's a remote URL
        if(s.startsWith('http://') || s.startsWith('https://')) {
          isRemote = true;
          md = s.endsWith('.md');
        } else {
          s.includes('.md')?md=true:null;
        }

        if(isRemote) {
          // Function to render content
          var renderContent = function(content) {
            if(md) {
              // Use Markdown format
              $('#contents').html(markdown.toHTML(content));
            } else {
              // Use AsciiDoc format
              $('#contents').html(Asciidoctor().convert(content))
                .find("span.icon")
                .replaceWith(function(e) {
                  return '<i class="fa fa-'+$(this).text().replace(/[\[\]]+/g,"")+'"/>';
                });
            }
          };

          // Try direct fetch first
          fetch(s)
            .then(response => {
              if (!response.ok) {
                throw new Error('Network response was not ok');
              }
              return response.text();
            })
            .then(renderContent)
            .catch(error => {
              // If direct fetch fails, try with CORS proxy
              console.log('Direct fetch failed, trying CORS proxy...', error);
              var proxyUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(s);
              fetch(proxyUrl)
                .then(response => {
                  if (!response.ok) {
                    throw new Error('Proxy response was not ok');
                  }
                  return response.text();
                })
                .then(renderContent)
                .catch(proxyError => {
                  $('#contents').html('<h1>Error loading remote content</h1><p>Could not load: ' + s + '</p><p>Direct fetch error: ' + error.message + '</p><p>CORS proxy error: ' + proxyError.message + '</p><p>The URL might be inaccessible or blocked.</p>');
                });
            });
        } else {
          // Load local file
          if( !md ) {
              // Use AsciiDoc format
            $('#contents').load(s+'.txt', function(){$('#contents').html(
                Asciidoctor().convert( $('#contents').text() )
            )
                    // Replace icons with FontAwesome compatible icon tags:
                    .find("span.icon")
                    .replaceWith(
                        function(e) {
                            return '<i class="fa fa-'+$(this).text().replace(/[\[\]]+/g,"")+'"/>';
                        }
                    );
            });
          } else {
              // Use Markdown format
              $('#contents').load(s, function(){$('#contents').html(markdown.toHTML($('#contents').text()))});
          }
        }
      });
    </script>
  </head>
  <body>
    <div id="contents">
    <img style="display:block; margin: auto;" src="inc/loading.gif" alt="Cargando...">
    </div>
  </body>
</html>
